$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json

name: mlflow_converter
version: 0.0.1
type: command

is_deterministic: True

display_name: MLFlow converter (Public Preview)
description: Component converts the input model to MLFlow format

environment: azureml:model-management:1

code: ../../src/
command: >
  python run_model_preprocess.py
  $[[--model-id ${{inputs.model_id}}]]
  $[[--task-type ${{inputs.task_type}}]]
  --mlflow-flavor ${{inputs.mlflow_flavor}}
  --model-path ${{inputs.model_path}}
  --model-info ${{inputs.model_info}}
  --mlflow-model-output-dir ${{outputs.mlflow_model_output}}

inputs:
  mlflow_flavor:
    type: string
    description: MLFlow flavor to translate model to. Flavor information is used to determine model loader module
    enum:
      # TODO: add support for other flavors such as pytorch, tensorflow etc
      - hftransformers

  model_id:
    type: string
    description: Huggingface model id (https://huggingface.co/<model_id>). A required parameter for hftransformers flavor. Can be provided as input here or in model_info JSON file.
    optional: True

  task_type:
    type: string
    enum:
      - multiclass
      - multilabel
      - fill-mask
      - token-classification
      - question-answering
      - summarization
      - text-generation
      - text-classification
      - translation
      - image-classification
      - image-classification-multilabel
      - text-to-image
    description: A Hugging face task on which model was trained on. A required parameter for hftransformers mlflow flavor. Can be provided as input here or in model_info JSON file.
    optional: True

  model_info:
    type: uri_file
    description: JSON file containing model download details

  model_path:
    type: uri_folder
    description: Path to the Hugging Face model
    mode: ro_mount
    optional: false

outputs:
  mlflow_model_output:
    type: mlflow_model
    description: Output path for the converted MLFlow model
    mode: rw_mount
